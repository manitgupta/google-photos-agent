sources:
  google-photos-spanner-db:
    kind: spanner
    project: ${PROJECT_ID}
    instance: ${SPANNER_INSTANCE_ID}
    database: ${SPANNER_DATABASE_ID}
    dialect: googlesql

tools:
  search_photos_by_person_name:
    kind: spanner-sql
    source: google-photos-spanner-db
    description: |
      Use this tool to find photos that a specific person appears in.
      Provide the full name of the person you are searching for.
      Example:
      {{
          "person_name": "Rohan"
      }}
    statement: |
      SELECT
          p.photo_id,
          p.timestamp,
          p.location_name,
          p.photo_location
      FROM Photo AS p
      JOIN PersonAppearsInPhoto AS pa ON p.photo_id = pa.photo_id
      JOIN Person AS pe ON pa.person_id = pe.person_id
      WHERE pe.name = @person_name
    parameters:
    - name: person_name
      type: string
      description: The full name of the person to search for.

  search_photos_by_location:
    kind: spanner-sql
    source: google-photos-spanner-db
    description: |
      Use this tool to find photos taken at a specific location.
      Provide the name of the location.
      Example:
      {{
          "location": "Goa, India"
      }}
    statement: |
      SELECT
          photo_id,
          timestamp,
          location_name,
          photo_location
      FROM Photo
      WHERE location_name = @location
    parameters:
    - name: location
      type: string
      description: The location where the photos were taken.

  search_photos_by_date_range:
    kind: spanner-sql
    source: google-photos-spanner-db
    description: |
      Use this tool to find photos within a specific date range.
      Provide a start and end date in 'YYYY-MM-DD' format.
      Example:
      {{
          "start_date": "2023-01-01",
          "end_date": "2023-12-31"
      }}
    statement: |
      SELECT
          photo_id,
          timestamp,
          location_name,
          photo_location
      FROM Photo
      WHERE CAST(timestamp AS DATE) BETWEEN @start_date AND @end_date
    parameters:
    - name: start_date
      type: string
      description: The start date of the range (YYYY-MM-DD).
    - name: end_date
      type: string
      description: The end date of the range (YYYY-MM-DD).

  search_photos_by_person_and_location:
    kind: spanner-sql
    source: google-photos-spanner-db
    description: |
      Use this tool to find photos of a specific person at a specific location.
      Provide the person's full name and the location.
      Example:
      {{
          "person_name": "Anjali",
          "location": "Goa, India"
      }}
    statement: |
      SELECT
          p.photo_id,
          p.timestamp,
          p.location_name,
          p.photo_location
      FROM Photo AS p
      JOIN PersonAppearsInPhoto AS pa ON p.photo_id = pa.photo_id
      JOIN Person AS pe ON pa.person_id = pe.person_id
      WHERE pe.name = @person_name AND p.location_name = @location
    parameters:
    - name: person_name
      type: string
      description: The full name of the person to search for.
    - name: location
      type: string
      description: The location where the photos were taken.

  search_photos_by_person_and_date_range:
    kind: spanner-sql
    source: google-photos-spanner-db
    description: |
      Use this tool to find photos of a specific person within a date range.
      Provide the person's full name and the start and end dates.
      Example:
      {{
          "person_name": "Priya",
          "start_date": "2021-01-01",
          "end_date": "2021-12-31"
      }}
    statement: |
      SELECT
          p.photo_id,
          p.timestamp,
          p.location_name,
          p.photo_location
      FROM Photo AS p
      JOIN PersonAppearsInPhoto AS pa ON p.photo_id = pa.photo_id
      JOIN Person AS pe ON pa.person_id = pe.person_id
      WHERE pe.name = @person_name AND CAST(p.timestamp AS DATE) BETWEEN @start_date AND @end_date
    parameters:
    - name: person_name
      type: string
      description: The full name of the person to search for.
    - name: start_date
      type: string
      description: The start date of the range (YYYY-MM-DD).
    - name: end_date
      type: string
      description: The end date of the range (YYYY-MM-DD).

toolsets:
  photo_search_toolset:
  - search_photos_by_person_name
  - search_photos_by_location
  - search_photos_by_date_range
  - search_photos_by_person_and_location
  - search_photos_by_person_and_date_range
